<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manage Services - Admin | Jatayu Travels</title>

  <!-- Bootstrap + Tailwind -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="../css/styles.css">
</head>

<body class="bg-slate-50">

  <!-- Admin Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="dashboard.html">Jatayu Admin</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#adminNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="adminNav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link active fw-semibold" href="manage_services.html">Manage Services</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="add_service.html">Add Service</a></li>
          <li class="nav-item"><a class="nav-link" href="manage_bookings.html">Manage Bookings</a></li>
          <li class="nav-item"><a class="nav-link" href="../jatayu_travels/index.html" target="_blank">View Site</a>
          </li>
          <li class="nav-item"><a class="nav-link btn btn-light btn-sm ms-lg-3 text-primary"
              href="login.html">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Header -->
  <header class="bg-white border-bottom">
    <div class="container py-4 d-flex flex-wrap align-items-center justify-content-between">
      <div>
        <h1 class="h3 fw-bold text-primary mb-1">Manage Services</h1>
        <p class="text-muted mb-0">Create, edit, publish, or remove travel services/packages.</p>
      </div>
      <div>
        <a href="add_service.html" class="btn btn-primary">+ Add New Service</a>
      </div>
    </div>
  </header>

  <!-- Controls -->
  <section class="container py-4">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="row g-3 align-items-center">
          <div class="col-md-6">
            <input id="searchInput" type="text" class="form-control" placeholder="Search by name, category…">
          </div>
          <div class="col-md-3">
            <select id="statusFilter" class="form-select">
              <option value="">All Status</option>
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
          <div class="col-md-3 text-md-end">
            <button id="resetBtn" class="btn btn-outline-secondary">Reset</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Table -->
  <section class="container pb-5">
    <div class="card shadow-sm border-0">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 60px;">#</th>
              <th>Name</th>
              <th>Category</th>
              <th>Price (₹)</th>
              <th>Status</th>
              <th style="width: 190px;">Actions</th>
            </tr>
          </thead>
          <tbody id="servicesTbody">
            <!-- rows injected by JS -->
          </tbody>
        </table>
      </div>
      <div id="emptyState" class="p-4 text-center text-muted d-none">
        No services yet. Click “Add New Service” to create your first one.
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-white border-top py-3 text-center text-muted">
    © <span id="year"></span> Jatayu Travels | Admin Panel
  </footer>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Helpers: storage
    const LS_KEY = 'jt_services';

    function getServices() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    }
    function setServices(list) {
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }

    // Render
    const tbody = document.getElementById('servicesTbody');
    const emptyState = document.getElementById('emptyState');
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');

    function render() {
      const q = (searchInput.value || '').toLowerCase().trim();
      const status = statusFilter.value;

      const data = getServices().filter(s => {
        const matchesQ = !q || [s.name, s.category, s.description].join(' ').toLowerCase().includes(q);
        const matchesStatus = !status || s.status === status;
        return matchesQ && matchesStatus;
      });

      tbody.innerHTML = '';
      if (data.length === 0) {
        emptyState.classList.remove('d-none');
        return;
      }
      emptyState.classList.add('d-none');

      data.forEach((s, idx) => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td class="fw-semibold">${s.name}</td>
          <td>${s.category || '-'}</td>
          <td>₹ ${Number(s.price || 0).toLocaleString('en-IN')}</td>
          <td>
            <span class="badge ${s.status === 'Active' ? 'bg-success' : 'bg-secondary'}">
              ${s.status || 'Inactive'}
            </span>
          </td>
          <td>
            <div class="btn-group">
              <a href="add_service.html?id=${encodeURIComponent(s.id)}" class="btn btn-sm btn-outline-primary">Edit</a>
              <button class="btn btn-sm btn-outline-warning" data-id="${s.id}" data-action="toggle">Toggle</button>
              <button class="btn btn-sm btn-outline-danger" data-id="${s.id}" data-action="delete">Delete</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Actions
    tbody.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const id = btn.getAttribute('data-id');
      const action = btn.getAttribute('data-action');
      let items = getServices();

      if (action === 'delete') {
        if (confirm('Delete this service? This cannot be undone.')) {
          items = items.filter(s => s.id !== id);
          setServices(items);
          render();
        }
      } else if (action === 'toggle') {
        items = items.map(s => s.id === id ? { ...s, status: (s.status === 'Active' ? 'Inactive' : 'Active') } : s);
        setServices(items);
        render();
      }
    });

    // Filters
    document.getElementById('resetBtn').addEventListener('click', () => {
      searchInput.value = '';
      statusFilter.value = '';
      render();
    });
    searchInput.addEventListener('input', render);
    statusFilter.addEventListener('change', render);

    // Seed demo (only if empty)
    (function seedIfEmpty() {
      if (getServices().length) return;
      const demo = [
        { id: crypto.randomUUID(), name: 'Hyderabad City Tour', category: 'City', price: 2999, status: 'Active', description: 'Charminar, Golconda, Hussain Sagar.' },
        { id: crypto.randomUUID(), name: 'Kerala Backwaters', category: 'Nature', price: 8999, status: 'Inactive', description: 'Houseboat experience at Alleppey.' },
      ];
      setServices(demo);
    })();

    // Year + initial render
    document.getElementById('year').textContent = new Date().getFullYear();
    render();
  </script>
</body>

</html>